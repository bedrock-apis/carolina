import { FrameSet } from '@serenityjs/raknet';
import { proto } from '@carolina/raknet';
import { FrameSet as FS } from '@sanctumterra/raknet';
import { bench, describe } from 'vitest';

describe('FrameSet Deserialization', () => {
   const TEST_PACKET = Buffer.from(
      '8c1d0000702ae01d0000020000000000001e00000000001a3d989e9c278ef7537643d7ba2df84552422c6bf8e4178d97af8bfc9357323f4733b0ff67617d94f6df1d40bf00e81770823ed02fa0badfd02fa0c1fd39f40b807e01e5fc02e81770221e0ffd024ee823e81790f10bf40b68b59eff897e01d83e3c364f9c33fe7b8e79d0fbf3c4adaef1e0bbfd79d09de389fbf3963bce6f163bfffbc8f7f1e7334c23693fded02d7fe0c83c68de79f46798f77e8c7f78e3f747cf235fbcfcf03c6861e7bb5b7e8df8f9d2f47db061b73bff41f47e779d1fbf3f4fbc1bffd49c6f11f92966e8dc38e3bd7ef862e579d7fc0b7b8a6afa8b5e947e38363f3e97e7c2ec8365697e62fbf9873bf36705f66bdd99e72db0bff1ee3c6f81f59587e821a0fe769af8a4dff05effdaeef5a667a54775debb50fea8a78708fe88f0fb46e7e86f7c883f04f4bfde994ffc09f410d0fffa107f08a1472d7f08e87f8dcf4b4cf8772d7edec459cf4b2d7f88a147adfc10725e3e9b1e62f44b2d7f08a187b7b56aec1721e76569aa55fbedccf4a8392f0dfa1d1dbb0fecf967881f231f6db5d79afc8ecef3cbf37af8fee2d55dc73cfdd71bc69bb566f1e69e7fd07f3a319ffb48be41e893fc18121fe3a8f7ff3d590f0263f563e345a13b6bd24f613d886676b4c9eba1b3faf2d6fd10a01f00f403807e00c7f61bfa0134d2afd00f00fa0114f13be80770227e07fd004ee923e80790f10bf40368b39eff997e001ab69ff0792cdd375c89ea47ccfcd5ac9e23cf2f17d13f99dd674c77e3579dfbd99fa407ffbc6756af7a9679e37bf36b05cd7b9e9e9a07cedf9f9df54338d3fc6b6d7f9e74783efe10377ffdf6d4bc60a1f44ef3393acf6b38df7ced93fc7771f283d573457bf14601fdf24fca0fa1f23414347f3d8b3feec6c72ffebcb07860299fe1bd327f9d7f1e3ded17a1e5f1cbfdf372467a7cca791166dfa0a59ed78735cde73d51bf4aeec995f3f403d88d470aace7dd89df0bace7dd8d3709ac5fdd8d375d1a3d6afb6788e08f83f410c01ff8fb2479afbed94d7ee1f538ae6d89ee8f6006ab37c5962ddf543bd4bfaf925f581e5d7f1a3d76e29122f943003d0ef1c74bd08f1f9116495deadf2d159f67c9d23e8b1e42e4693d7f08a0c701f921e4bc7c3a3d049c9703fc21821ef5fd11c49c1764f9d8bf50c5ebdbe6e7a5413fa963f799df46ce817e02b707e971ffd4ae5f7e11dfddeaa4dfbde7aede39eb95d37833e9a76f0fa03f3cc483211e0cf1608807433c18e2c1100f867830c483211efcbf1a0f3ecbbc5b565f7a601e7387f890758ef9e3d29179c71de26f37e5fbf25f95f9bfbcf7fd77c2e7f3b27aea2c5e6fa3d2f7778ac79e615efabb237edeb175701e7787f9e6d279e66757d7cffa850b886f9f67ff4bf3ae2bfbdfe13c55e687eb62f21d8ec993cbe37f7b5af0a7a079f4d5fd1728ffc93c87627fce23ffcbe7b5437cb63c4ffcd1d996f941c4fe57e7bd77c9272aefff91f37fd9f1d8d5d307e637ad537ce9403cd6dfeaa379e4888f1f9cb31ff919fb6f9fb1dfb4007a1c88a774e78f83f15801fc7128fe78c9f1fa83f1a533d2636d607eb6ce116fbbe8fc8583f1a5f3d143843c3dc01fffca7c8e33d2a3fb7939c81fdde971201e2be4bc1c88c79e911e7be7e5df158fbd578295d664fe38e997ffeaad14ab43ffe98d3f9414438d93b1ed67f6a716e2f391f68f26f5cd4bbcff0eb22d727fabecf4173a63fff0bdfaef676349ea8bc3b3cf4b37e4783abb4bb8fbef872cbe7de27e265e5abdcd87b734b3fdcbf2a377fbe79d9c3f30d9e7e75aff788674d2bf7b3477356fbc1c2cd0369653fa1ee657577e0d645a3fbf4032e6af78a1e7fce65aafdef2fe7d36b4ee274b64607e7af57aca285ce96fd6caf7e751f2e2a2f061a62a536b1507343f3bb24c53bd21f9fbc7f8f3b7b37a8f27dafd3bc937f0',
      'hex',
   );
   bench('SerenityJS', () => void new FrameSet(TEST_PACKET).deserialize(), { iterations: 1000 });
   bench('Sanctumterra', () => void new FS(TEST_PACKET).deserialize(), { iterations: 1000 });
   bench(
      'Carolina Raknet',
      () => {
         const dataview = new DataView(TEST_PACKET.buffer, TEST_PACKET.byteOffset, TEST_PACKET.byteLength);
         proto.readUint24(dataview, 1);
         let offset = 4;
         while (offset < TEST_PACKET.length) offset = proto.readCapsuleFrameData(dataview, offset).offset;
      },
      { iterations: 1000 },
   );
});
